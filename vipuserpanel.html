<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zyricco | Special Users Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, set, onValue, get, push, update } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC9yCEe4a9KC0Ph64gMkrDn_Cfah0TxlMw",
            authDomain: "swiftgain.firebaseapp.com",
            databaseURL: "https://swiftgain-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "swiftgain",
            storageBucket: "swiftgain.firebasestorage.app",
            messagingSenderId: "751911092919",
            appId: "1:751911092919:web:bd0ab90ca8b4432f0d4332"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId;
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const rtdb = getDatabase(app);

        let userId = null;
        let currentUserRole = 'novice';
        let maxTopupAmount = 1000;

        // Global references to modals
        let viewStatusModal, noticeModal, boostTopupModal, loadingOverlay, taskDetailModal;

        function showNotice(title, message) {
            document.getElementById('noticeModalTitle').textContent = title;
            document.getElementById('noticeModalText').textContent = message;
            noticeModal.style.display = 'flex';
        }

        // --- CORE PANEL FUNCTIONS ---
        async function sendChatMessage() {
            if (!userId) { showMessage('You must be logged in to chat.', 'error'); return; }
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            if (message === '') { showMessage('Message cannot be empty.', 'error'); return; }
            const messageData = { message: message, timestamp: Date.now(), senderId: userId, senderType: 'user', isRead: false };
            try {
                const messagesRef = ref(rtdb, `chats/${userId}/messages`);
                await push(messagesRef, messageData);
                chatInput.value = '';
            } catch (error) {
                console.error("Error sending chat message:", error);
                showMessage(`Failed to send message: ${error.message}`, 'error');
            }
        }
        async function viewAffiliateDetails() {
            const affiliateId = document.getElementById('mainAffiliateSelector').value;
            if (!affiliateId) { showMessage('Please select an affiliate account first.', 'error'); return; }
            try {
                const affiliateRef = ref(rtdb, `affiliate/${affiliateId}`);
                const snapshot = await get(affiliateRef);
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    document.getElementById('statusModalAffiliateName').textContent = data.fullName || data.email || `ID: ${affiliateId.substring(0,8)}...`;
                    document.getElementById('statusModalCurrentStatus').textContent = data.status || 'Not Set';
                    viewStatusModal.style.display = 'flex';
                } else { showMessage('Affiliate data not found.', 'error'); }
            } catch (error) {
                console.error("Error fetching affiliate status:", error);
                showMessage(`Error fetching details: ${error.message}`, 'error');
            }
        }
        async function requestPlanChange() {
            const affiliateId = document.getElementById('mainAffiliateSelector').value;
            if (!affiliateId) { showMessage('Please select an affiliate to request a plan change for.', 'error'); return; }
            try {
                const noticeRef = ref(rtdb, 'admin/config/planChangeNotice');
                const snapshot = await get(noticeRef);
                const noticeMessage = snapshot.exists() ? snapshot.val() : "Your request has been submitted for review.";
                const requestsRef = ref(rtdb, 'admin/requests/planChange');
                await push(requestsRef, { requestedBy: userId, affiliateId: affiliateId, timestamp: Date.now(), status: 'pending' });
                showNotice('Plan Change Request', noticeMessage);
            } catch (error) {
                console.error("Error requesting plan change:", error);
                showMessage(`Request failed: ${error.message}`, 'error');
            }
        }
        async function showBoostTopupModal() {
            try {
                const maxAmountRef = ref(rtdb, 'admin/config/maxTopupAmount');
                const snapshot = await get(maxAmountRef);
                if (snapshot.exists()) { maxTopupAmount = snapshot.val(); }
            } catch (error) { console.log("Could not fetch max top-up amount, using default.", error); }
            document.getElementById('boostMaxAmount').textContent = maxTopupAmount.toLocaleString();
            boostTopupModal.style.display = 'flex';
        }
        async function submitBoostTopup(event) {
            event.preventDefault();
            const affiliateId = document.getElementById('boostAffiliateSelector').value;
            const amountInput = document.getElementById('boostAmount');
            const amount = parseInt(amountInput.value, 10);
            if (!affiliateId) { showMessage('Please select an affiliate to top-up.', 'error'); return; }
            if (isNaN(amount) || amount <= 0) { showMessage('Please enter a valid, positive amount.', 'error'); return; }
            if (amount > maxTopupAmount) { showMessage(`Amount cannot exceed the maximum of ${maxTopupAmount.toLocaleString()}.`, 'error'); return; }
            try {
                const requestsRef = ref(rtdb, 'admin/requests/topup');
                await push(requestsRef, { requestedBy: userId, affiliateId: affiliateId, amount: amount, timestamp: Date.now(), status: 'pending' });
                boostTopupModal.style.display = 'none';
                event.target.reset();
                showMessage('Top-up request submitted successfully!', 'success');
            } catch (error) {
                console.error("Error submitting top-up request:", error);
                showMessage(`Request failed: ${error.message}`, 'error');
            }
        }
        async function loadCustomDomainInfo(currentUserId) {
            const container = document.getElementById('customDomainContent');
            container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)]">Loading...</p>`;
            try {
                const domainRef = ref(rtdb, `users/${currentUserId}/features/customDomainInfo`);
                const snapshot = await get(domainRef);
                if (snapshot.exists() && snapshot.val()) { container.innerHTML = snapshot.val(); } 
                else { container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)]">Custom Domain feature is not configured for your account.</p>`; }
            } catch (error) {
                console.error("Error loading custom domain info:", error);
                container.innerHTML = `<p class="text-center text-red-500">Error loading content.</p>`;
            }
        }
        async function loadPromotions(currentUserId) {
            const container = document.getElementById('promotionsContent');
            container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)]">Loading...</p>`;
            try {
                const userPromoRef = ref(rtdb, `admin/user_content/promotions/${currentUserId}`);
                const userPromoSnap = await get(userPromoRef);
                if (userPromoSnap.exists() && userPromoSnap.val()) { container.innerHTML = userPromoSnap.val(); return; }
                const quotesRef = ref(rtdb, 'admin/content/promotion_quotes');
                const snapshot = await get(quotesRef);
                if (snapshot.exists()) {
                    const quotes = [];
                    snapshot.forEach(childSnapshot => { quotes.push(childSnapshot.val().text); });
                    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                    container.innerHTML = `<div class="text-center p-6 border border-dashed border-[var(--border-color)] rounded-lg"><p class="text-2xl italic text-white">"${randomQuote}"</p></div>`;
                } else { container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)]">No promotions available right now.</p>`; }
            } catch (error) {
                console.error("Error loading promotions:", error);
                container.innerHTML = `<p class="text-center text-red-500">Error loading promotions.</p>`;
            }
        }
        async function loadSpecialServices(currentUserId) {
            const container = document.getElementById('specialServicesContent');
            container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)] col-span-2">Loading...</p>`;
            const serviceDefinitions = {
                vaultx: { name: "Vaultx", description: "A highly secure, encrypted digital vault for storing sensitive information and digital assets with multi-factor authentication." },
                creditx: { name: "Creditx", description: "Access a credit line for your marketing campaigns. Get pre-approved funds to scale operations with flexible repayment terms." },
                personal_host: { name: "Personal Host", description: "A dedicated, high-performance hosting environment for your landing pages. Enjoy optimized speeds and enhanced security." },
                experts_consultation: { name: "Experts Consultation", description: "Schedule one-on-one consultations with our marketing experts. Get personalized advice to maximize your profitability." }
            };
            try {
                const servicesRef = ref(rtdb, `admin/user_services/${currentUserId}`);
                const snapshot = await get(servicesRef);
                const enabledServices = snapshot.val() || {};
                container.innerHTML = '';
                Object.keys(serviceDefinitions).forEach(key => {
                    const service = serviceDefinitions[key];
                    const isEnabled = enabledServices[key] === true;
                    const statusClass = isEnabled ? 'text-green-400' : 'text-yellow-500';
                    const statusText = isEnabled ? 'Enabled' : 'Not Available';
                    const cardOpacity = isEnabled ? 'opacity-100' : 'opacity-60';
                    const serviceHtml = `<div class="p-6 rounded-lg bg-gray-800 border border-gray-700 flex flex-col transition-opacity duration-300 ${cardOpacity}"><div class="flex-grow"><h3 class="text-xl font-bold text-white mb-2">${service.name}</h3><p class="text-gray-400 text-sm mb-4">${service.description}</p></div><div class="mt-auto text-right"><span class="text-sm font-semibold py-1 px-3 rounded-full bg-gray-700 ${statusClass}">${statusText}</span></div></div>`;
                    container.insertAdjacentHTML('beforeend', serviceHtml);
                });
            } catch (error) {
                console.error("Error loading special services:", error);
                container.innerHTML = `<p class="text-center text-red-500 col-span-2">Error loading services.</p>`;
            }
        }
        async function loadTermsAndConditions() {
             const container = document.getElementById('termsContent');
              container.innerHTML = `<p class="text-center text-[var(--text-color-secondary)]">Loading...</p>`;
              try {
                  const termsRef = ref(rtdb, `admin/content/termsAndConditions`);
                  const snapshot = await get(termsRef);
                  if (snapshot.exists() && snapshot.val()) { container.innerHTML = snapshot.val(); } 
                  else { container.innerHTML = `<h3 class="font-bold text-lg text-white mb-2">User Agreement & Disclaimers</h3><p class="mb-4">By accessing this panel, you acknowledge and agree to the following terms and conditions. Failure to comply may result in immediate and permanent suspension of your account and legal action.</p><h4 class="font-semibold text-white mt-4 mb-2">1. Anti-Money Laundering (AML) Policy</h4><p class="mb-2 text-sm">This platform strictly prohibits any and all activities related to money laundering or the financing of terrorist activities. We are committed to full compliance with all applicable laws and regulations regarding AML. You agree to provide any and all information we may require to verify your identity and the nature of your transactions.</p><h4 class="font-semibold text-white mt-4 mb-2">2. Company's Rights</h4><p class="mb-2 text-sm">We reserve the absolute right, at our sole discretion, to:</p><ul class="list-disc list-inside text-sm space-y-1 pl-4"><li>Block, suspend, or terminate your account at any time, for any reason, without prior notice or liability.</li><li>Implement IP address bans against any user or range of IPs deemed to be malicious or in violation of our terms.</li><li>Investigate any suspicious activity and report it to the relevant law enforcement agencies.</li><li>Pursue legal action against any user who engages in fraudulent, illegal, or harmful activities on our platform.</li></ul><h4 class="font-semibold text-white mt-4 mb-2">3. User Responsibilities</h4><ul class="list-disc list-inside text-sm space-y-1 pl-4"><li>You are solely responsible for all activities that occur under your account.</li><li>You agree not to misuse this panel, including but not limited to, attempting to gain unauthorized access, disrupting service, or exploiting vulnerabilities.</li><li>You confirm that all funds used on this platform are from legitimate sources and are not the proceeds of crime.</li></ul><h4 class="font-semibold text-white mt-4 mb-2">4. Disclaimer of Liability</h4><p class="text-sm">This service is provided "as is" without any warranties. We are not liable for any financial losses or damages incurred from the use of this panel.</p>`;}
              } catch (error) { console.error("Error loading terms:", error); container.innerHTML = `<p class="text-center text-red-500">Could not load Terms & Conditions.</p>`; }
        }
        async function claimReward(taskId) {
            if (!userId || !taskId) return;
            const claimButton = document.getElementById(`claim-btn-${taskId}`);
            if (claimButton) { claimButton.disabled = true; claimButton.textContent = 'Claiming...'; }
            const taskRef = ref(rtdb, `admin/tasks/${userId}/${taskId}`);
            try {
                await update(taskRef, { claimed: true });
                showMessage('Reward successfully claimed!', 'success');
                loadTasks(userId);
            } catch (error) {
                console.error("Error claiming reward:", error);
                showMessage(`Failed to claim reward: ${error.message}`, 'error');
                if (claimButton) { claimButton.disabled = false; claimButton.textContent = 'Claim Now'; }
            }
        }
        async function loadTasks(currentUserId) {
            const container = document.getElementById('taskListContainer');
            const progressContainer = document.getElementById('taskProgressContainer');
            container.innerHTML = `<p class="text-center text-gray-400">Loading tasks...</p>`;
            progressContainer.innerHTML = '';
            try {
                const tasksRef = ref(rtdb, `admin/tasks/${currentUserId}`);
                const snapshot = await get(tasksRef);
                if (snapshot.exists()) {
                    const tasks = snapshot.val();
                    container.innerHTML = '';
                    const taskIds = Object.keys(tasks);
                    let completedCount = 0;
                    if (taskIds.length === 0) { container.innerHTML = `<p class="text-center text-gray-400">No tasks assigned to you yet.</p>`; return; }
                    taskIds.forEach(taskId => {
                        const task = tasks[taskId];
                        if (task.completed) completedCount++;
                        let statusOrActionHtml = '';
                        const rewardHtml = task.reward ? `<span class="font-bold text-yellow-400 mr-4">+${task.reward} Reward</span>` : '';
                        if (task.completed) {
                            if (task.claimed) { statusOrActionHtml = `<span class="text-sm font-semibold py-1 px-3 rounded-full bg-green-600 text-white">Claimed</span>`; } 
                            else if (task.reward && task.reward > 0) { statusOrActionHtml = `<button id="claim-btn-${taskId}" onclick="claimReward('${taskId}')" class="btn-primary text-sm py-1 px-3">Claim Now</button>`; } 
                            else { statusOrActionHtml = `<span class="text-sm text-gray-500">Completed</span>`; }
                        } else { statusOrActionHtml = `<span id="countdown-${taskId}" class="text-sm font-mono text-right text-yellow-400"></span>`; }
                        const taskHtml = `<div class="task-item flex items-center p-4 rounded-lg bg-gray-800 border border-gray-700 transition-all duration-300 ${task.completed ? 'opacity-70' : ''}" data-task-id="${taskId}"><input type="checkbox" id="${taskId}" class="h-5 w-5 rounded bg-transparent border-2 border-gray-600 text-yellow-400 focus:ring-yellow-400" ${task.completed ? 'checked' : ''} disabled><label for="${taskId}" class="ml-4 text-md flex-grow ${task.completed ? 'line-through text-gray-500' : 'text-gray-200'}">${task.text}</label><div class="ml-auto flex items-center gap-4">${rewardHtml}${statusOrActionHtml}</div></div>`;
                        container.insertAdjacentHTML('beforeend', taskHtml);
                        if (!task.completed) {
                            const dueDate = task.dueDate || (Date.now() + 3 * 24 * 60 * 60 * 1000);
                            const countdownElement = document.getElementById(`countdown-${taskId}`);
                            const intervalId = setInterval(() => {
                                const distance = dueDate - new Date().getTime();
                                if (distance < 0) { clearInterval(intervalId); countdownElement.textContent = "Expired"; countdownElement.classList.add("text-red-500"); return; }
                                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                            }, 1000);
                        }
                    });
                    const progressPercentage = Math.round((completedCount / taskIds.length) * 100);
                    progressContainer.innerHTML = `<span class="text-lg font-semibold text-yellow-400">${progressPercentage}%</span><p class="text-xs text-gray-400">Completed ${completedCount} of ${taskIds.length}</p>`;
                     // Add event listeners to task items
                    document.querySelectorAll('.task-item').forEach(item => {
                        item.addEventListener('click', async () => {
                            const taskId = item.dataset.taskId;
                            const taskRef = ref(rtdb, `admin/tasks/${currentUserId}/${taskId}`);
                            const snapshot = await get(taskRef);
                            if (snapshot.exists()) {
                                const task = snapshot.val();
                                document.getElementById('taskDetailTitle').textContent = task.text;
                                document.getElementById('taskDetailDescription').textContent = task.description || 'No detailed description available.';
                                document.getElementById('taskDetailStatus').textContent = task.completed ? 'Completed' : 'In Progress';
                                taskDetailModal.style.display = 'flex';
                            }
                        });
                    });
                } else { container.innerHTML = `<p class="text-center text-gray-400">No tasks assigned to you yet.</p>`; }
            } catch (error) { console.error("Error loading tasks:", error); container.innerHTML = `<p class="text-center text-red-500">Could not load tasks.</p>`; }
        }
        async function loadAffiliateData(currentUserId) {
            const downlineAffiliatesTableBody = document.getElementById('downlineAffiliatesTableBody');
            const affiliateSelectors = document.querySelectorAll('.affiliate-selector');
            downlineAffiliatesTableBody.innerHTML = '<tr><td colspan="4" class="px-4 py-2 text-center text-gray-400">Loading...</td></tr>';
            affiliateSelectors.forEach(selector => selector.innerHTML = '<option value="">-- Loading... --</option>');
            try {
                const affiliatesRef = ref(rtdb, 'affiliate');
                const snapshot = await get(affiliatesRef);
                const allAffiliates = snapshot.val() || {};
                downlineAffiliatesTableBody.innerHTML = '';
                affiliateSelectors.forEach(selector => selector.innerHTML = '<option value="">-- Select an affiliate --</option>');
                const affiliatedUsers = Object.keys(allAffiliates).map(key => ({ id: key, ...allAffiliates[key] })).filter(aff => aff.createdBy === currentUserId);
                if (affiliatedUsers.length === 0) {
                    downlineAffiliatesTableBody.innerHTML = '<tr><td colspan="4" class="px-4 py-2 text-center text-gray-400">No downline affiliates found.</td></tr>';
                    affiliateSelectors.forEach(selector => selector.innerHTML = '<option value="">-- No affiliates found --</option>');
                } else {
                    affiliatedUsers.forEach(affiliate => {
                        const row = downlineAffiliatesTableBody.insertRow();
                        row.classList.add('hover:bg-gray-800');
                        row.innerHTML = `<td class="px-4 py-2 whitespace-nowrap text-gray-200">${affiliate.id.substring(0, 8)}...</td><td class="px-4 py-2 whitespace-nowrap text-${affiliate.isApproved ? 'green-500' : (affiliate.status === 'pending' ? 'yellow-500' : 'red-500')}">${affiliate.status || 'N/A'}</td><td class="px-4 py-2 whitespace-nowrap text-gray-400">${affiliate.subAccounts || 0}</td>`;
                        const optionText = affiliate.fullName || affiliate.email || `ID: ${affiliate.id.substring(0,8)}...`;
                        affiliateSelectors.forEach(selector => {
                            const option = document.createElement('option');
                            option.value = affiliate.id;
                            option.textContent = optionText;
                            selector.appendChild(option);
                        });
                    });
                }
            } catch (error) { console.error("Error loading affiliate data:", error); downlineAffiliatesTableBody.innerHTML = '<tr><td colspan="3" class="px-4 py-2 text-center text-red-500">Error loading affiliates.</td></tr>'; affiliateSelectors.forEach(selector => selector.innerHTML = '<option value="">-- Error --</option>'); }
        }
        async function loadChatMessages(currentUserId) {
            const chatMessagesContainer = document.querySelector('.chat-messages');
            chatMessagesContainer.innerHTML = '<p class="text-sm mb-2 text-gray-400"><em>Loading...</em></p>';
            try {
                const chatRef = ref(rtdb, `chats/${currentUserId}/messages`);
                onValue(chatRef, (snapshot) => {
                    chatMessagesContainer.innerHTML = '';
                    if (!snapshot.exists()) { chatMessagesContainer.innerHTML = '<p class="text-sm mb-2 text-gray-400"><em>No chat history.</em></p>'; return; }
                    const chatMessages = [];
                    snapshot.forEach(childSnapshot => { chatMessages.push(childSnapshot.val()); });
                    chatMessages.sort((a, b) => a.timestamp - b.timestamp).forEach(msg => {
                        const isUser = msg.senderId === userId;
                        const messageBubble = isUser ? 'bg-yellow-500 text-white ml-auto' : 'bg-gray-800 text-gray-200 mr-auto';
                        const messageHtml = `<div class="mb-2 ${isUser ? 'text-right' : 'text-left'}"><div class="inline-block rounded-lg px-3 py-2 max-w-sm ${messageBubble}"><p class="text-sm">${msg.message}</p></div></div>`;
                        chatMessagesContainer.insertAdjacentHTML('beforeend', messageHtml);
                    });
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                }, { onlyOnce: false });
            } catch (error) { console.error("Error loading live chat messages:", error); chatMessagesContainer.innerHTML = '<p class="text-sm mb-2 text-red-500"><em>Error loading chat.</em></p>'; }
        }
        async function fetchAndObserveSimulatedCounts() {
            if (!userId) return;
            const countsRef = ref(rtdb, `artifacts/${appId}/public/data/app_metrics/simulated_counts`);
            onValue(countsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    document.getElementById('zyricoCountDisplay').textContent = (data.zyricoCount || 0).toLocaleString();
                    document.getElementById('gainxCountDisplay').textContent = (data.gainxCount || 0).toLocaleString();
                }
            });
        }
        async function loadNotifications() {
            const notificationsContainer = document.querySelector('#notifications .space-y-3');
            notificationsContainer.innerHTML = '<p class="text-center text-gray-400">Loading...</p>';
            try {
                const notificationsRef = ref(rtdb, 'notifications');
                const snapshot = await get(notificationsRef);
                const notificationsData = snapshot.val() || {};
                notificationsContainer.innerHTML = '';
                const notifications = Object.values(notificationsData).sort((a, b) => b.timestamp - a.timestamp);
                if (notifications.length === 0) { notificationsContainer.innerHTML = '<p class="text-center text-gray-400">No new notifications.</p>'; } 
                else {
                    notifications.forEach(notif => {
                        const timeAgo = formatTimeAgo(new Date(notif.timestamp));
                        const iconColor = notif.title.includes("Win") || notif.title.includes("APPROVED") ? 'text-green-500' : 'text-indigo-500';
                        const iconPath = `<path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"></path>`;
                        const notificationHtml = `<div class="p-4 rounded-lg shadow-sm flex items-start bg-gray-800 border border-gray-700"><svg class="w-6 h-6 ${iconColor} mr-3 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">${iconPath}</svg><div><p class="font-medium text-gray-200">${notif.title}</p><p class="text-sm text-gray-400">${notif.message} <span class="text-xs opacity-75">${timeAgo}</span></p></div></div>`;
                        notificationsContainer.insertAdjacentHTML('beforeend', notificationHtml);
                    });
                }
            } catch(error){ notificationsContainer.innerHTML = '<p class="text-center text-red-500">Error loading notifications.</p>'; }
        }
        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 31536000; if (interval > 1) return Math.floor(interval) + "y ago";
            interval = seconds / 2592000; if (interval > 1) return Math.floor(interval) + "m ago";
            interval = seconds / 86400; if (interval > 1) return Math.floor(interval) + "d ago";
            interval = seconds / 3600; if (interval > 1) return Math.floor(interval) + "h ago";
            interval = seconds / 60; if (interval > 1) return Math.floor(interval) + "min ago";
            return Math.floor(seconds) + "s ago";
        }
        window.showMessage = (message, type = 'info') => {
            const messageText = document.getElementById('messageText');
            const messageBox = document.getElementById('messageBox');
            messageText.textContent = message;
            messageBox.className = 'message-box';
            if (type === 'success') messageBox.classList.add('bg-green-100');
            else if (type === 'error') messageBox.classList.add('bg-red-100');
            else messageBox.classList.add('bg-blue-100');
            messageBox.style.display = 'block';
            setTimeout(() => { messageBox.style.display = 'none'; }, 5000);
        };

        const showLoginScreen = () => {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            loadingOverlay.style.display = 'none';
        };
        const showRegisterScreen = () => {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        };
        const showConsentScreen = () => {
            document.getElementById('welcomeScreen').style.display = 'flex';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'none';
            loadingOverlay.style.display = 'none';
        }
        const showMainPanel = (user) => {
            userId = user.uid;
            document.getElementById('displayUserId').textContent = `User ID: ${userId.substring(0, 12)}...`;
            document.getElementById('mainPanel').style.display = 'block';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'none';
            fetchAndObserveSimulatedCounts();
            loadAffiliateData(userId);
            loadNotifications();
            loadTasks(userId);
            loadingOverlay.style.display = 'none';
        }

        function applyTabPermissions(permissions) {
            document.querySelectorAll('.tab-btn').forEach(button => {
                const tabId = button.dataset.tab;
                const perm = permissions[tabId];
                button.removeAttribute('data-blocked');
                button.removeAttribute('data-reason');
                button.classList.remove('tab-blocked');
                if (perm && perm.allowed === false) {
                    button.setAttribute('data-blocked', 'true');
                    button.setAttribute('data-reason', perm.reason);
                    button.classList.add('tab-blocked');
                }
            });
        }
       
        document.addEventListener('DOMContentLoaded', () => {
            viewStatusModal = document.getElementById('viewStatusModal');
            noticeModal = document.getElementById('noticeModal');
            boostTopupModal = document.getElementById('boostTopupModal');
            loadingOverlay = document.getElementById('loadingOverlay');
            taskDetailModal = document.getElementById('taskDetailModal');
            window.claimReward = claimReward;

            document.getElementById('agreeButton').addEventListener('click', () => {
                sessionStorage.setItem('agreedToTerms', 'true');
                document.getElementById('welcomeScreen').style.display = 'none';
                if(auth.currentUser) { onAuthStateChanged(auth, user => { if(user) showMainPanel(user); }); }
            });

            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try { await signInWithEmailAndPassword(auth, e.target.email.value, e.target.password.value); } 
                catch (error) { showMessage(`Login Failed: ${error.message}`, 'error'); }
            });

            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const cred = await createUserWithEmailAndPassword(auth, e.target.newEmail.value, e.target.newPassword.value);
                    await set(ref(rtdb, `users/${cred.user.uid}`), { email: cred.user.email, role: 'novice' });
                    showMessage('Registration successful! Please log in.', 'success');
                    showLoginScreen();
                } catch(error) { showMessage(`Registration Failed: ${error.message}`, 'error'); }
            });

            document.getElementById('logoutButton').addEventListener('click', () => {
                signOut(auth);
                sessionStorage.removeItem('agreedToTerms');
            });

            document.getElementById('sendChatMessageButton').addEventListener('click', sendChatMessage);
            document.getElementById('viewDetailsButton').addEventListener('click', viewAffiliateDetails);
            document.getElementById('requestPlanChangeButton').addEventListener('click', requestPlanChange);
            document.getElementById('boostTopupButton').addEventListener('click', showBoostTopupModal);
            document.getElementById('boostTopupForm').addEventListener('submit', submitBoostTopup);

            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    viewStatusModal.style.display = 'none';
                    noticeModal.style.display = 'none';
                    boostTopupModal.style.display = 'none';
                    taskDetailModal.style.display = 'none';
                });
            });

            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (button.hasAttribute('data-blocked')) {
                        const reason = button.getAttribute('data-reason');
                        showNotice('Access Denied', reason);
                        return; // Prevent switching tab
                    }

                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    button.classList.add('active');
                    const targetTab = document.getElementById(button.dataset.tab);
                    if (targetTab) targetTab.classList.add('active');

                    if(button.dataset.tab === 'liveChat') loadChatMessages(userId);
                    if(button.dataset.tab === 'notifications') loadNotifications();
                    if(button.dataset.tab === 'customDomain') loadCustomDomainInfo(userId);
                    if(button.dataset.tab === 'promotions') loadPromotions(userId);
                    if(button.dataset.tab === 'specialServices') loadSpecialServices(userId);
                    if(button.dataset.tab === 'terms') loadTermsAndConditions();
                    if(button.dataset.tab === 'tasks') loadTasks(userId);
                });
            });

            document.getElementById('showRegister').addEventListener('click', e => { e.preventDefault(); showRegisterScreen(); });
            document.getElementById('showLogin').addEventListener('click', e => { e.preventDefault(); showLoginScreen(); });
        });

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userRef = ref(rtdb, `users/${user.uid}`);
                const snapshot = await get(userRef);
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    currentUserRole = userData.role || 'novice';
                   
                    const permissionsRef = ref(rtdb, `admin/permissions/${user.uid}`);
                    const permissionsSnapshot = await get(permissionsRef);
                    applyTabPermissions(permissionsSnapshot.val() || {});

                    const customDomainTab = document.getElementById('customDomainTabButton');
                    customDomainTab.style.display = 'inline-block'; // Always show it if it might be blocked
                    if (!customDomainTab.hasAttribute('data-blocked') && !userData.features?.hasCustomDomain) {
                        customDomainTab.style.display = 'none'; // Only hide if NOT blocked AND feature is disabled
                    }
                   
                    document.getElementById('displayUserRole').textContent = `Level: ${currentUserRole.toUpperCase()}`;
                    const authorizedRoles = ['standard', 'premium', 'admin'];
                    if (authorizedRoles.includes(currentUserRole)) {
                        if (sessionStorage.getItem('agreedToTerms') === 'true') {
                            showMainPanel(user);
                        } else {
                            showConsentScreen();
                        }
                    } else {
                        showMessage('Your account does not have permission to access this panel.', 'error');
                        await signOut(auth);
                    }
                } else {
                    showMessage('User data not found. Please contact support.', 'error');
                    await signOut(auth);
                }
            } else {
                userId = null;
                showLoginScreen();
            }
        });
    </script>
    <style>
        :root {
            --primary-bg-color: #1f2937;
            --secondary-bg-color: #374151;
            --card-bg-color: #4b5563;
            --text-color-primary: #f9fafb;
            --text-color-secondary: #d1d5db;
            --accent-color: #f59e0b;
            --accent-color-hover: #d97706;
            --border-color: #6b7280;
            --font-primary: 'Noto Serif', serif;
            --font-secondary: 'Roboto', sans-serif;
        }

        body {
            font-family: var(--font-secondary);
            background-color: var(--primary-bg-color);
            color: var(--text-color-primary);
        }

        .full-screen-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            text-align: center;
        }

        .auth-content, .welcome-content, .modal-content {
            background-color: var(--secondary-bg-color);
            padding: 2.5rem;
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.5s ease-out;
        }

        .auth-content {
            max-width: 450px;
        }

        .welcome-content {
            max-width: 700px;
        }

        .modal-content {
            max-width: 500px;
        }

        h1, h2, h3 {
            font-family: var(--font-primary);
        }

        .main-panel {
            background-color: var(--secondary-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .tab-btn {
            background-color: var(--card-bg-color);
            color: var(--text-color-primary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            border-radius: 0.5rem;
        }

        .tab-btn:hover {
            background-color: var(--border-color);
            color: var(--accent-color);
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }

        .tab-content {
            display: none;
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color-secondary);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        input, textarea, select {
            background-color: var(--primary-bg-color);
            color: var(--text-color-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            transition: all 0.2s ease;
            width: 100%;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }

        ::placeholder {
            color: var(--text-color-secondary);
            opacity: 0.7;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: #fff;
            padding: 10px 20px;
            font-weight: 600;
            border-radius: 5px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: var(--accent-color-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .btn-primary:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--accent-color);
            font-weight: 500;
            border-radius: 5px;
            transition: all 0.2s ease;
            border: 2px solid var(--accent-color);
            cursor: pointer;
            padding: 8px 18px;
        }

        .btn-secondary:hover {
            background-color: var(--accent-color);
            color: #fff;
        }

        .message-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: none;
        }

        .message-box.bg-green-100 {
            background-color: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #a7f3d0;
        }

        .message-box.bg-red-100 {
            background-color: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fecaca;
        }

        .message-box.bg-blue-100 {
            background-color: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #dbeafe;
        }

        .blinking-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 8px;
            vertical-align: middle;
            animation: blink-yellow 1.5s infinite ease-in-out;
        }

        .chat-messages {
            height: 250px;
            overflow-y: auto;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes blink-yellow {
            0%, 100% {
                background-color: #f59e0b;
                opacity: 1;
            }
            50% {
                background-color: #d97706;
                opacity: 0.5;
            }
        }

        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="checkbox"]:checked {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        input[type="checkbox"]:checked::before {
            content: 'âœ”';
            display: block;
            text-align: center;
            color: white;
            font-size: 0.8rem;
            line-height: 1.1rem;
        }

        .tab-blocked {
            opacity: 0.5;
            cursor: not-allowed !important;
        }

        .tab-blocked:hover {
            transform: none !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div id="loadingOverlay" class="full-screen-container"><h1 class="text-2xl text-[var(--accent-color)] font-bold">Initializing Panel...</h1></div>

    <div id="viewStatusModal" class="full-screen-container bg-black bg-opacity-70" style="display: none;"><div class="modal-content relative"><button class="close-modal-btn absolute top-4 right-4 text-2xl font-bold text-gray-400 hover:text-white">&times;</button><h2 class="text-2xl font-semibold mb-4 text-center">Affiliate Account Status</h2><p class="text-center text-lg"><strong>Affiliate:</strong> <span id="statusModalAffiliateName" class="text-[var(--accent-color)]">Loading...</span></p><p class="text-center text-lg mt-2"><strong>Current Status:</strong> <span id="statusModalCurrentStatus" class="font-bold text-yellow-400">Loading...</span></p></div></div>
    <div id="noticeModal" class="full-screen-container bg-black bg-opacity-70" style="display: none;"><div class="modal-content relative"><button class="close-modal-btn absolute top-4 right-4 text-2xl font-bold text-gray-400 hover:text-white">&times;</button><h2 id="noticeModalTitle" class="text-2xl font-semibold mb-4 text-center">Notice</h2><p id="noticeModalText" class="text-center text-[var(--text-color-secondary)]">Loading...</p><button class="close-modal-btn btn-primary w-full mt-6">OK</button></div></div>
    <div id="boostTopupModal" class="full-screen-container bg-black bg-opacity-70" style="display: none;"><div class="modal-content relative"><button class="close-modal-btn absolute top-4 right-4 text-2xl font-bold text-gray-400 hover:text-white">&times;</button><h2 class="text-2xl font-semibold mb-4 text-center">Boost / Top-up Affiliate</h2><form id="boostTopupForm" class="space-y-4"><div><label for="boostAffiliateSelector" class="block text-sm font-medium mb-1 text-left">Select Affiliate:</label><select id="boostAffiliateSelector" class="affiliate-selector w-full" required></select></div><div><label for="boostAmount" class="block text-sm font-medium mb-1 text-left">Top-up Amount:</label><input type="number" id="boostAmount" name="boostAmount" placeholder="Enter amount" required><p class="text-xs text-right text-[var(--text-color-secondary)] mt-1">Max: <span id="boostMaxAmount">1,000</span></p></div><div class="flex justify-between gap-4"><button type="button" class="close-modal-btn btn-secondary flex-grow">Cancel</button><button type="submit" class="btn-primary flex-grow">Submit Request</button></div></form></div></div>

    <div id="taskDetailModal" class="full-screen-container bg-black bg-opacity-70" style="display: none;">
        <div class="modal-content relative">
            <button class="close-modal-btn absolute top-4 right-4 text-2xl font-bold text-gray-400 hover:text-white">&times;</button>
            <h2 id="taskDetailTitle" class="text-2xl font-semibold mb-4 text-center">Task Details</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="font-semibold text-lg">Description</h3>
                    <p id="taskDetailDescription" class="text-gray-400"></p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg">Status</h3>
                    <p id="taskDetailStatus" class="text-yellow-400"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="loginScreen" class="full-screen-container" style="display: none;"><div class="auth-content"><h1 class="text-3xl font-extrabold mb-6 text-[var(--accent-color)]">GainX User Login</h1><div id="messageBox" class="message-box"> <span id="messageText"></span> </div><form id="loginForm" class="space-y-4"><div> <label for="loginEmail" class="block text-sm font-medium mb-1 text-left">Email</label> <input type="email" id="loginEmail" name="email" required> </div><div> <label for="loginPassword" class="block text-sm font-medium mb-1 text-left">Password</label> <input type="password" id="loginPassword" name="password" required> </div><button type="submit" class="btn-primary w-full">Login</button><p class="text-sm text-center text-[var(--text-color-secondary)] mt-4"> No account? <a href="#" id="showRegister" class="text-[var(--accent-color)] hover:underline">Register here</a> </p></form><form id="registerForm" class="space-y-4" style="display:none;"><h2 class="text-2xl font-semibold mb-4 text-left">Register New Account</h2><div><label for="registerEmail" class="block text-sm font-medium mb-1 text-left">Email</label><input type="email" id="registerEmail" name="newEmail" required></div><div><label for="registerPassword" class="block text-sm font-medium mb-1 text-left">Password (min. 6 characters)</label><input type="password" id="registerPassword" name="newPassword" required></div><button type="submit" class="btn-primary w-full">Register</button><p class="text-sm text-center text-[var(--text-color-secondary)] mt-4"> Have an account? <a href="#" id="showLogin" class="text-[var(--accent-color)] hover:underline">Login here</a> </p></form></div></div>

    <div id="welcomeScreen" class="full-screen-container" style="display: none;"><div class="welcome-content"><h1>Welcome to the <span class="text-[var(--accent-color)]">GainX Private User Panel</span></h1><p>This panel provides access to advanced features and dedicated support.</p><p class="font-bold text-lg text-[var(--accent-color)] mt-6">Please review the terms before proceeding.</p><h3>User Agreement & Disclaimers:</h3><ul class="text-sm text-left list-disc list-inside"><li>You agree to all our Terms, Privacy, and AML policies.</li><li>Misuse of this panel will result in an immediate ban.</li><li>You are responsible for all actions from your account.</li><li>We reserve the right to ban accounts without warning.</li></ul><button id="agreeButton" class="btn-primary mt-6 px-8 py-3 text-xl">I Agree & Proceed</button></div></div>

    <div id="mainPanel" class="main-panel p-6 md:p-8 rounded-xl w-full max-w-5xl mx-auto my-8" style="display: none;">
        <div class="absolute top-4 right-4"><button id="logoutButton" class="btn-secondary px-4 py-2 text-sm">Logout</button></div>
        <h1 class="text-3xl font-extrabold mb-4 text-center text-[var(--accent-color)]">Special Users Panel</h1>

        <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-sm text-center mb-4 p-2 rounded-lg bg-[var(--card-bg-color)] border border-[var(--border-color)]">
            <span id="displayUserId" class="font-medium text-[var(--text-color-secondary)]">User ID: ...</span>
            <span id="displayUserRole" class="text-md font-medium text-[var(--accent-color)]">Level: ...</span>
        </div>

        <div id="messageBox" class="message-box"><span id="messageText"></span></div>

        <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-6">
            <button class="tab-btn active px-4 py-2 font-medium" data-tab="manageAffiliate">Manage Affiliate</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="tasks">Tasks</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="liveChat">Live Chat</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="affiliateUnderUser">Status & Sub-accounts</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="notifications">Notifications</button>
            <button id="customDomainTabButton" class="tab-btn px-4 py-2 font-medium" data-tab="customDomain" style="display: none;">Custom Domain</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="promotions">Promotions</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="specialServices">Special Services</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="terms">Terms & Conditions</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="totalUsersCount">Total Users</button>
            <button class="tab-btn px-4 py-2 font-medium" data-tab="changePassword">Settings</button>
        </div>

        <div id="manageAffiliate" class="tab-content active"><h2 class="text-2xl font-semibold mb-6">Manage Affiliate Account</h2><div class="p-4 rounded-lg bg-gray-800 border border-gray-700 mb-6"><label for="mainAffiliateSelector" class="block text-lg font-medium mb-2 text-white">Select Affiliate Account:</label><select id="mainAffiliateSelector" class="affiliate-selector max-w-md"></select><p class="text-xs text-gray-400 mt-1">Actions on this tab apply to the selected affiliate.</p></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="p-4 rounded-lg bg-gray-800 border border-gray-700"><h3 class="text-lg font-medium mb-2">View Status</h3><p class="text-sm mb-3 text-gray-400">Check the affiliate's current status.</p><button id="viewDetailsButton" class="btn-primary w-full">View Details</button></div><div class="p-4 rounded-lg bg-gray-800 border border-gray-700"><h3 class="text-lg font-medium mb-2">Request Plan Change</h3><p class="text-sm mb-3 text-gray-400">Submit a request to change the affiliate plan.</p><button id="requestPlanChangeButton" class="btn-primary w-full">Request Change</button></div><div class="p-4 rounded-lg bg-gray-800 border border-gray-700"><h3 class="text-lg font-medium mb-2">Boost / Top-up</h3><p class="text-sm mb-3 text-gray-400">Request a top-up for an affiliated user.</p><button id="boostTopupButton" class="btn-primary w-full">Boost/Top-up</button></div></div></div>

        <div id="tasks" class="tab-content"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-semibold">Your Onboarding Tasks</h2><div id="taskProgressContainer" class="text-right"></div></div><p class="mb-6 text-gray-400">Complete these tasks to get fully acquainted with our platform features and earn rewards.</p><div id="taskListContainer" class="space-y-4"></div></div>

        <div id="liveChat" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Live Chat with Admin</h2><div class="chat-interface p-4 rounded-lg border border-gray-700"><div class="chat-messages p-2 rounded-lg bg-gray-900 border border-gray-700 mb-4"></div><div class="flex gap-2"><input type="text" id="chatInput" placeholder="Type your message..." class="flex-grow"><button id="sendChatMessageButton" class="btn-primary">Send</button></div></div></div>
        <div id="affiliateUnderUser" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Your Downline Affiliates</h2><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-700"><thead><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Affiliate ID</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Status</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Sub-accounts</th></tr></thead><tbody id="downlineAffiliatesTableBody" class="divide-y divide-gray-700"></tbody></table></div></div>
        <div id="notifications" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Notifications</h2><p class="mb-4 text-gray-400">Updates from the Admin Panel will appear here.</p><div class="space-y-3 max-h-96 overflow-y-auto"></div></div>
        <div id="customDomain" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Custom Domain</h2><div id="customDomainContent" class="prose prose-invert max-w-none"></div></div>
        <div id="promotions" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Promotions</h2><div id="promotionsContent" class="prose prose-invert max-w-none"></div></div>
        <div id="specialServices" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Special Services</h2><p class="mb-6 text-gray-400">The following premium services have been made available for your account.</p><div id="specialServicesContent" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
        <div id="terms" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Terms & Conditions</h2><div id="termsContent" class="prose prose-invert max-w-none"></div></div>
        <div id="totalUsersCount" class="tab-content text-center"><h2 class="text-2xl font-semibold mb-4">Live Platform Engagement</h2><div class="flex flex-col md:flex-row justify-center gap-6"><div class="flex items-center justify-center bg-gray-800 p-4 rounded-lg border border-gray-700"><span class="text-xl font-semibold mr-3">ZYRICO:</span><p id="zyricoCountDisplay" class="text-4xl font-bold text-yellow-400">0</p><span class="blinking-dot"></span></div><div class="flex items-center justify-center bg-gray-800 p-4 rounded-lg border border-gray-700"><span class="text-xl font-semibold mr-3">GainX:</span><p id="gainxCountDisplay" class="text-4xl font-bold text-yellow-400">0</p><span class="blinking-dot"></span></div></div></div>
        <div id="changePassword" class="tab-content"><h2 class="text-2xl font-semibold mb-4">Account Settings</h2><form id="changePasswordForm" class="space-y-4 max-w-md"><h3 class="text-lg text-white">Change Password</h3><div><label for="oldPassword" class="block text-sm font-medium mb-1">Old Password</label><input type="password" id="oldPassword"></div><div><label for="newPassword" class="block text-sm font-medium mb-1">New Password</label><input type="password" id="newPassword"></div><div><label for="repeatNewPassword" class="block text-sm font-medium mb-1">Repeat New Password</label><input type="password" id="repeatNewPassword"></div><button type="submit" class="btn-primary">Save Password</button></form></div>
    </div>
</body>
</html>
